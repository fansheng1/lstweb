<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />

  <style type="text/css">
    body, html {width: 100%;height: 100%;margin:0;font-family:"微软雅黑";}
    #allmap{width:100%;height:100%;}
    p{margin-left:5px; font-size:14px;}
  </style>
  <!--<script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=Spgy3GeQOYSpGWPEHn8dM5O5hWA9k9Ni"></script>-->
	<script type="text/javascript" src="http://api.map.baidu.com/getscript?v=2.0&ak=7Bkkj254sprlok0qZvMrxW62GZOB1olp"></script>
  <script type="text/javascript" src="js/baidu-map-import.js"></script>
  <script src="js/jquery-3.1.1.min.js"></script>
  <title>地图</title>
</head>
<body>
        <div id="allmap">
        </div> 
</body>

<script type="text/javascript">
	function GetRequest() { 
		var url = location.search; //获取url中"?"符后的字串 
		var theRequest = new Object(); 
		if (url.indexOf("?") != -1) { 
			var str = url.substr(1); 
			strs = str.split("&"); 
			for(var i = 0; i < strs.length; i ++) { 
			theRequest[strs[i].split("=")[0]]=unescape(strs[i].split("=")[1]); 
			}
		}
		return theRequest;
	}
	// get url parameter
	var qs = GetRequest();

	// 百度地图API功能  
	var map = new BMap.Map("allmap");

	//创建坐标点
	var point = new BMap.Point(114.025973657,22.5460535462); 
	map.centerAndZoom(point, 17);
	map.enableScrollWheelZoom();//启用地图滚轮放大缩小

	// 添加带有定位的导航控件
	var navigationControl = new BMap.NavigationControl({
		// 靠左上角位置
		anchor: BMAP_ANCHOR_TOP_LEFT,
		// LARGE类型
		type: BMAP_NAVIGATION_CONTROL_LARGE,
		// 启用显示定位
		enableGeolocation: true // 会多出一个点
	});

	map.addControl(navigationControl);

	//地图导航控件    
	var nav_size = new BMap.Size(10,10);//地图导航控件的参数    
	var map_Control = new BMap.NavigationControl({anchor:BMAP_ANCHOR_TOP_LEFT,offset:nav_size,type:BMAP_NAVIGATION_CONTROL_LARGE,showZoomInfo:true});
	map.addControl(map_Control);

	//添加选择城市的控件  
	var size = new BMap.Size(50, 20);  
	map.addControl(new BMap.CityListControl({  
		anchor: BMAP_ANCHOR_TOP_RIGHT,  
		offset: size,   
	})); 


	////////////////////////////////

	$.ajax({
		url : "/controller/search/"+qs.taskid+"/cameras",
		type : "get",
		success : function(data) {
			if(data.status == false) {
				return;
			}
			if(data.camera_groups.length == 0){
				alert("本任务没有包含任何摄像机组,请确认选择正确的任务！");
				return
			}
			var cameras = data.camera_groups[0].cameras;

			if(cameras.length == 0) {
				alert("本任务没有包含任何摄像机, 请确认选择正确的任务！");
				return
			}
			for(var i=0; i<cameras.length; i++){
				var ca = cameras[i]
				if(i == 0) {
					//创建坐标点
					var point = new BMap.Point(ca.lng,ca.lat); 
					map.centerAndZoom(point, 17);
				}
				if(ca.lng && ca.lat) {
					setCameraPos(map, {lng: ca.lng,lat:ca.lat}, "摄像机名称:"+ca.name);
				}				
			}			
		}
	});

</script>

</html>